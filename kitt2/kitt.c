#include <avr/pgmspace.h>
#include <avr/power.h>
#include "light_ws2812.h"

void frame_player ();

struct cRGB leds[8];

const uint16_t some_pixels[8][8][3] PROGMEM = {
// frame 0
  {
   {0xff, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   },
// frame 1
  {
   {0x00, 0x00, 0x00},
   {0xff, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   },
// frame 2
  {
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0xff, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   },
// frame 3
  {
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0xff, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   },
// frame 4
  {
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0xff, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   },
// frame 5
  {
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0xff, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   },
// frame 6
  {
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0xff, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   },
// frame 7
  {
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0x00, 0x00, 0x00},
   {0xff, 0x00, 0x00},
   }
};

int
main (int argc, char **argv)
{
  frame_player ();
}

void
frame_player ()
{

  for (int frame = 0; frame < 8; frame++)
    {
      for (int i = 0; i < 8; i++)
	{

	  uint8_t red =
	    (uint8_t) pgm_read_word_near (&(some_pixels[frame][i][0]));
	  uint8_t green =
	    (uint8_t) pgm_read_word_near (&(some_pixels[frame][i][1]));
	  uint8_t blue =
	    (uint8_t) pgm_read_word_near (&(some_pixels[frame][i][2]));

	  leds[i].r = red;
	  leds[i].g = green;
	  leds[i].b = blue;
	  ws2812_sendarray ((uint8_t *) leds, 8 * 3);
	}

      _delay_ms (50);
    }

  for (int frame = 7; frame >= 0; frame--)
    {
      for (int i = 0; i < 8; i++)
	{

	  uint8_t red =
	    (uint8_t) pgm_read_word_near (&(some_pixels[frame][i][0]));
	  uint8_t green =
	    (uint8_t) pgm_read_word_near (&(some_pixels[frame][i][1]));
	  uint8_t blue =
	    (uint8_t) pgm_read_word_near (&(some_pixels[frame][i][2]));

	  leds[i].r = red;
	  leds[i].g = green;
	  leds[i].b = blue;
	  ws2812_sendarray ((uint8_t *) leds, 8 * 3);
	}

      _delay_ms (50);
    }
}
